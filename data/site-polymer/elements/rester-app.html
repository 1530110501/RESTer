<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-media-query/iron-media-query.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-styles/paper-styles.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/paper-tooltip/paper-tooltip.html">

<link rel="import" href="data/rester-data-settings-behavior.html">
<link rel="import" href="layout/rester-navigation-list.html">
<link rel="import" href="layout/rester-drawer-footer-links.html">
<link rel="import" href="layout/rester-pages-title.html">
<link rel="import" href="layout/rester-pages.html">
<link rel="import" href="pages/rester-page-about.html">
<link rel="import" href="pages/rester-page-environments.html">
<link rel="import" href="pages/rester-page-history.html">
<link rel="import" href="pages/rester-page-request.html">
<link rel="import" href="pages/rester-page-settings.html">
<link rel="import" href="pages/rester-pagetitle-request.html">
<link rel="import" href="utils/rester-error.html">
<link rel="import" href="utils/rester-hotkeys-cheat-sheet.html">

<dom-module id="rester-app">
    <template>
        <style include="iron-flex iron-flex-alignment iron-positioning">
            :host {
                --primary-text-color: var(--dark-theme-text-color);
                --primary-background-color: var(--dark-theme-background-color);
                --secondary-text-color: var(--dark-theme-secondary-color);
                --disabled-text-color: var(--dark-theme-disabled-color);
                --divider-color: var(--dark-theme-divider-color);
                --error-color: var(--paper-deep-orange-a700);

                --primary-color: var(--paper-cyan-500);
                --light-primary-color: var(--paper-cyan-100);
                --dark-primary-color: var(--paper-cyan-700);

                --accent-color: var(--paper-amber-a200);
                --light-accent-color: var(--paper-amber-a100);
                --dark-accent-color: var(--paper-amber-a400);

                display: block;
                min-height: 100vh;
                background-color: var(--primary-background-color);
                color: var(--primary-text-color);
                @apply(--paper-font-common-base);
            }

            paper-drawer-panel {
                --paper-drawer-panel-drawer-container: {
                    background-color: var(--primary-background-color);
                    border-right: 1px solid var(--divider-color);
                };
            }

            paper-header-panel[drawer] paper-toolbar {
                --paper-toolbar-background: none;
                --paper-toolbar-title: {
                    margin-left: 0;
                };
                --paper-toolbar: {
                    border-bottom: 1px solid var(--divider-color);
                };
            }

            paper-header-panel[main] rester-pages {
                max-width: 1000px;
                margin: 0 auto;
                padding: 16px;
            }
        </style>

        <app-location route="{{route}}" use-hash-as-path></app-location>
        <app-route
                route="[[route]]"
                pattern="/:page"
                data="{{routeData}}"
                tail="{{routeTail}}"></app-route>

        <paper-drawer-panel
                id="drawer"
                drawer-width="[[drawerWidth]]"
                responsive-width="[[responsiveWidth]]">
            <!-- Navigation -->
            <paper-header-panel drawer mode="seamed">
                <paper-toolbar>
                    <div class="title">RESTer</div>
                    <iron-media-query
                            query="(min-width: [[responsiveWidthMin]]) and (max-width: [[responsiveWidthMax]])"
                            query-matches="{{showDrawerLock}}"></iron-media-query>
                    <paper-icon-button
                            icon="[[_getDrawerToggleIcon(settings.pinSidenav)]]"
                            on-tap="_toggleDrawerLockOpen"
                            hidden="[[!showDrawerLock]]"></paper-icon-button>
                </paper-toolbar>
                <div class="fit layout vertical justified">
                    <rester-navigation-list
                            route="[[route]]"
                            on-item-activated="_onNavigationItemActivated"></rester-navigation-list>
                    <rester-drawer-footer-links>
                        <a href="#" on-tap="_showShortcuts">Shortcuts</a> &dash;
                        <a href="#/about">About</a>
                    </rester-drawer-footer-links>
                </div>
            </paper-header-panel>

            <!-- Main -->
            <paper-header-panel main>
                <paper-toolbar>
                    <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
                    <div class="title" hidden="[[pageTitleElementAvailable]]">[[pageTitle]]</div>
                    <rester-pages-title
                            page="[[page]]"
                            available="{{pageTitleElementAvailable}}"
                            value="{{pageTitleElementValue}}"
                            hidden="[[!pageTitleElementAvailable]]"
                            class="flex"></rester-pages-title>
                </paper-toolbar>
                <rester-pages
                        page="[[page]]"
                        page-title="{{pageTitle}}"
                        page-title-element-value="{{pageTitleElementValue}}"
                        route="[[routeTail]]"
                        role="main"></rester-pages>
            </paper-header-panel>
        </paper-drawer-panel>

        <rester-error></rester-error>
        <rester-hotkeys-cheat-sheet id="cheatSheet"></rester-hotkeys-cheat-sheet>
    </template>

    <script>
        Polymer({
            is: 'rester-app',

            behaviors: [
                RESTer.SettingsBehavior
            ],

            properties: {
                page: String,
                pageTitle: {
                    type: String,
                    observer: '_onPageTitleChanged'
                },
                drawerWidth: {
                    type: String,
                    value: '320px'
                },
                responsiveWidth: {
                    type: String,
                    computed: '_computeResponsiveWidth(settings.pinSidenav)'
                },
                responsiveWidthMin: {
                    type: String,
                    value: '600px'
                },
                responsiveWidthMax: {
                    type: String,
                    value: '1279px'
                }
            },

            observers: [
                '_routePageChanged(routeData.page)'
            ],

            _routePageChanged (page) {
                this.page = page || 'request';
            },

            _onPageTitleChanged () {
                document.title = `RESTer - ${this.pageTitle}`;
            },

            _computeResponsiveWidth () {
                return this.settings.pinSidenav ? this.responsiveWidthMin : this.responsiveWidthMax;
            },

            _getDrawerToggleIcon () {
                return this.settings.pinSidenav ? 'lock-outline' : 'lock-open';
            },

            _toggleDrawerLockOpen () {
                this.set('settings.pinSidenav', !this.settings.pinSidenav);
            },

            _onNavigationItemActivated () {
                this.$.drawer.closeDrawer();
            },

            _showShortcuts (e) {
                e.preventDefault();
                this.$.cheatSheet.show();
            }
        });
    </script>
</dom-module>
